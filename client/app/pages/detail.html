<!--
 Copyright (C) 2015-2016  DING Changchang (of Canaan Creative)

 This file is part of Avalon Management System (AMS).

 AMS is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 AMS is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with AMS. If not, see <http://www.gnu.org/licenses/>.
-->
<md-content layout="row" layout-align="center center" flex ng-if="!vm.data.nodes">
	<md-progress-circular class="md-accent" md-mode="indeterminate"></md-progress-circular>
</md-content>

<md-content layout="row" flex ng-if="!!vm.data.nodes">
	<!-- Node List -->
	<md-content class="node" layout="row">
		<md-list flex>
			<md-list-item
					ng-repeat="node in vm.data.nodes"
					class="node-selected-{{ node.selected }}">
				<a ng-click="vm.select(node)">
					<md-item-content md-ink-ripple layout="row" layout-align="start center">
						<div class="inset">
							{{ node.ip + ':' + node.port }}
						</div>
						<md-divider></md-divider>
					</md-item-content>
				</a>
			</md-list-item>
		</md-list>
	</md-content>

	<md-content layout="row" flex>
		<md-tabs
				md-selected="vm.status.tabIndex"
				md-stretch-tabs="always"
				ng-if="!!vm.status.node"
				md-no-ink flex>

			<!-- Summary -->
			<md-tab md-on-select="vm.getTab('summary')">
				<md-tab-label>Summary</md-tab-label>
				<md-tab-body>
					<md-content layout="column" flex>

						<div layout="row">
							<div flex="50">
								<md-card>
									<md-card-header>
										<md-card-header-text>
											<div class="md-title">Hashrate Graph</div>
										</md-card-header-text>
									</md-card-header>
										<md-card-content ng-if="!vm.hashrateChart.loaded" layout="row" layout-align="center center">
											<div style="height:{{ vm.hashrateChart.options.chart.height }}px" layout="column" layout-align="center center">
												<md-progress-circular class="md-accent" md-mode="indeterminate"></md-progress-circular>
											</div>
										</md-card-content>
										<md-card-content ng-if="vm.hashrateChart.loaded">
											<nvd3 options="vm.hashrateChart.options" data="vm.data.nodeHashrate">
											</nvd3>
										</md-card-content>
								</md-card>
							</div>
							<div flex>
								<md-card>
									<md-card-header>
										<md-card-header-text>
											<div class="md-title">Summary</div>
										</md-card-header-text>
									</md-card-header>
									<md-card-content ng-if="!vm.status.summaryCardLoaded" layout="row" layout-align="center center">
										<md-content>
											<div style="height:{{ vm.hashrateChart.options.chart.height }}px" layout="column" layout-align="center center">
												<md-progress-circular class="md-accent" md-mode="indeterminate"></md-progress-circular>
											</div>
										</md-content>
									</md-card-content>
									<md-card-content ng-if="vm.status.summaryCardLoaded">
										<md-content>
											<div style="height:{{ vm.hashrateChart.options.chart.height }}px" layout="row">
												<div flex="50">
													<md-list>
														<md-list-item ng-repeat="item in vm.summaryTable | limitTo: vm.summaryTable.length / 2">
															<span class="md-body-2">{{ item.name }}</span>
															<span class="md-body-1">: {{ item.value(vm.data.summary[0]) }}</span>
														</md-list-item>
													</md-list>
												</div>
												<div flex>
													<md-list>
														<md-list-item ng-repeat="item in vm.summaryTable | limitTo: vm.summaryTable.length : vm.summaryTable.length / 2">
															<span class="md-body-2">{{ item.name }}</span>
															<span class="md-body-1">: {{ item.value(vm.data.summary[0]) }}</span>
														</md-list-item>
													</md-list>
												</div>
											</div>
										</md-content>
									</md-card-content>
								</md-card>
							</div>
						</div>

						<md-card>
							<md-card-header>
								<md-card-header-text>
									<div class="md-title">Pool Status</div>
								</md-card-header-text>
							</md-card-header>
							<md-card-content layout="row" ng-if="!vm.status.poolCardLoaded" layout-align="center center">
								<md-progress-circular class="md-accent" md-mode="indeterminate"></md-progress-circular>
							</md-card-content>
							<md-card-content ng-if="vm.status.poolCardLoaded">
								<md-table-container>
									<table md-table md-progress="deferred">
										<thead md-head>
											<tr md-row>
												<th md-column ng-repeat="column in vm.poolTable">
													{{ column.name }}
													<md-tooltip ng-if="column.tooltip !== undefined">
														{{ column.tooltip }}
													</md-tooltip>
												</th>
											</tr>
										</thead>
										<tbody md-body>
											<tr md-row ng-repeat="pool in vm.data.pool">
												<td md-cell ng-repeat="column in vm.poolTable">
													{{ column.value(pool) }}
												</td>
											</tr>
										</tbody>
									</table>
								</md-table-container>
							</md-card-content>
						</md-card>

					</md-content>
				</md-tab-body>
			</md-tab>

			<!-- Devices -->
			<md-tab md-on-select="vm.getTab('device')">
				<md-tab-label>Devices</md-tab-label>
				<md-tab-body>
					<md-content ng-if="!vm.status.tabLoaded" layout="row" layout-fill layout-align="center center">
						<md-progress-circular class="md-accent" md-mode="indeterminate"></md-progress-circular>
					</md-content>
					<md-content ng-if="vm.status.tabLoaded">
						<md-table-container>
							<table md-table>
								<thead md-head md-order="vm.sortIndex">
									<tr md-row>
										<th md-column md-desc
												ng-repeat="column in vm.deviceTable"
												md-order-by="{{ column.index }}">
											{{ column.name }}
										</th>
									</tr>
								</thead>
								<tbody md-body>
									<tr md-row ng-repeat="device in vm.data.device | orderBy: vm.getDeviceTable() : vm.sortReverse">
										<td md-cell ng-repeat="column in vm.deviceTable">
											{{ column.value(device) }}
										</td>
									</tr>
								</tbody>
							</table>
						</md-table-container>
					</md-content>
				</md-tab-body>
			</md-tab>

			<!-- Modules -->
			<md-tab md-on-select="vm.getTab('module')">
				<md-tab-label>Modules</md-tab-label>
				<md-tab-body>
					<md-content ng-if="!vm.status.tabLoaded" layout="row" layout-fill layout-align="center center">
						<md-progress-circular class="md-accent" md-mode="indeterminate"></md-progress-circular>
					</md-content>
					<md-content ng-if="vm.status.tabLoaded">
						<md-table-container>
							<table md-table>
								<thead md-head md-order="vm.sortIndex">
									<tr md-row>
										<th md-column>LED</th>
										<th md-column md-desc
												ng-repeat="column in vm.moduleTable"
												md-order-by="{{ column.index }}">
											{{ column.name }}
										</th>
									</tr>
								</thead>
								<tbody md-body>
									<tr md-row ng-repeat="module in vm.data.module | orderBy: vm.getModuleTable() : vm.sortReverse"
											class="highlight-{{ module.highlight }} dark-{{ module.theme }}">
										<td md-cell>
											<md-switch
												ng-model="module.led"
												ng-true-value="1"
												ng-false-value="0"
												ng-change="vm.setSingleLED(module)"
												aria-label="LED">
											</md-switch>
										</td>
										<td md-cell ng-repeat="column in vm.moduleTable">
											{{ column.value(module) }}
										</td>
									</tr>
								</tbody>
							</table>
						</md-table-container>
					</md-content>
				</md-tab-body>
			</md-tab>

			<!-- Config -->
			<md-tab md-on-select="vm.getTab('config')">
				<md-tab-label>Config</md-tab-label>
				<md-tab-body>
					<md-content layout="row" layout-fill ng-if="!vm.status.tabLoaded" layout-align="center center">
						<md-progress-circular class="md-accent" md-mode="indeterminate"></md-progress-circular>
					</md-content>
					<md-content
							ng-if="vm.status.tabLoaded"
							layout-align="center center"
							layout="row" flex>
						<div layout="column">
							<h4>Node</h4>
							<md-input-container>
								<label>NTP</label>
								<input ng-model="vm.data.config.ntp_enable" disabled="{{ vm.auth }}"/>
							</md-input-container>
							<md-input-container>
								<label>API Allow</label>
								<input ng-model="vm.data.config.api_allow" disabled="{{ vm.auth }}"/>
							</md-input-container>
							<md-input-container>
								<label>More Options</label>
								<input ng-model="vm.data.config.more_options" disabled="{{ vm.auth }}"/>
							</md-input-container>

							<md-divider></md-divider>

							<h4>Module</h4>
							<div layout="row">
								<md-input-container>
									<label>Fan</label>
									<input ng-model="vm.data.config.fan" disabled="{{ vm.auth }}"/>
								</md-input-container>
								<md-input-container>
									<label>Voltage</label>
									<input ng-model="vm.data.config.chip_voltage" disabled="{{ vm.auth }}"/>
								</md-input-container>
								<md-checkbox
										ng-model="vm.data.config.autoAdjust"
										layout-align="center center"
										layout="row"
										disabled="{{ vm.auth }}">
								<small class="md-caption">Auto Adjust</small>
								</md-checkbox>
							</div>

							<md-divider></md-divider>

							<h4>Pool</h4>
							<md-input-container>
								<label>Pool Balance</label>
								<input ng-model="vm.data.config.pool_balance" disabled="{{ vm.auth }}"/>
							</md-input-container>
							<div layout="row">
								<md-input-container flex="50">
									<label>Address</label>
									<input ng-model="vm.data.config.pool1url" disabled="{{ vm.auth }}"/>
								</md-input-container>
								<md-input-container flex="25">
									<label>Worker</label>
									<input ng-model="vm.data.config.pool1user" disabled="{{ vm.auth }}"/>
								</md-input-container>
								<md-input-container flex="25">
									<label>Password</label>
									<input ng-model="vm.data.config.pool1pw" disabled="{{ vm.auth }}"/>
								</md-input-container>
							</div>
							<div layout="row">
								<md-input-container flex="50">
									<label>Address</label>
									<input ng-model="vm.data.config.pool2url" disabled="{{ vm.auth }}"/>
								</md-input-container>
								<md-input-container flex="25">
									<label>Worker</label>
									<input ng-model="vm.data.config.pool2user" disabled="{{ vm.auth }}"/>
								</md-input-container>
								<md-input-container flex="25">
									<label>Password</label>
									<input ng-model="vm.data.config.pool2pw" disabled="{{ vm.auth }}"/>
								</md-input-container>
							</div>
							<div layout="row">
								<md-input-container flex="50">
									<label>Address</label>
									<input ng-model="vm.data.config.pool3url" disabled="{{ vm.auth }}"/>
								</md-input-container>
								<md-input-container flex="25">
									<label>Worker</label>
									<input ng-model="vm.data.config.pool3user" disabled="{{ vm.auth }}"/>
								</md-input-container>
								<md-input-container flex="25">
									<label>Password</label>
									<input ng-model="vm.data.config.pool3pw" disabled="{{ vm.auth }}"/>
								</md-input-container>
							</div>

						</div>
					</md-content>
				</md-tab-body>
			</md-tab>

		</md-tabs>
	</md-content>
</md-content>
