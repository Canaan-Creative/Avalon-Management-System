<!--
 Copyright (C) 2015-2016  DING Changchang (of Canaan Creative)

 This file is part of Avalon Management System (AMS).

 AMS is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 AMS is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with AMS. If not, see <http://www.gnu.org/licenses/>.
-->
<md-content layout="column" flex>
	<div layout="row">
		<div flex="50">
			<!--BEGIN Hashrate-->
			<md-card>
				<md-card-header>
					<md-card-header-text>
						<div class="md-title">Hashrate Graph</div>
					</md-card-header-text>
				</md-card-header>
				<md-card-content ng-if="!vm.hashrateChart.loaded" layout="row" layout-align="center center">
					<div style="height:{{ vm.hashrateChart.options.chart.height }}px" layout="column" layout-align="center center">
						<md-progress-circular class="md-accent" md-mode="indeterminate"></md-progress-circular>
					</div>
				</md-card-content>
				<md-card-content ng-if="vm.hashrateChart.loaded">
					<nvd3 options="vm.hashrateChart.options" data="vm.data.farmHashrate">
					</nvd3>
				</md-card-content>
			</md-card>
			<!--END Hashrate-->
		</div>

		<div flex>
			<!--BEGIN Aliverate-->
			<md-card>
				<md-card-header>
					<md-card-header-text>
						<div class="md-title">Aliverate Graph</div>
					</md-card-header-text>
				</md-card-header>
				<md-card-content ng-if="!vm.aliverateChart.loaded" layout="row" layout-align="center center">
					<div style="height:{{ vm.aliverateChart.options.chart.height }}px" layout="column" layout-align="center center">
						<md-progress-circular class="md-accent" md-mode="indeterminate"></md-progress-circular>
					</div>
				</md-card-content>
				<md-card-content ng-if="vm.aliverateChart.loaded">
					<nvd3 options="vm.aliverateChart.options" data="vm.data.aliverate">
					</nvd3>
				</md-card-content>
			</md-card>
			<!--END Aliverate-->
		</div>
	</div>

	<md-content layout="row" flex>
		<md-content flex="50">
			<!--BEGIN Map-->
			<md-card>
				<md-card-header>
					<md-card-header-text>
						<div class="md-title">Map</div>
					</md-card-header-text>
				</md-card-header>
				<md-card-content ng-if="!vm.farmMap.loaded" layout="row" layout-align="center center">
					<div layout="column" layout-align="center center">
						<md-progress-circular class="md-accent" md-mode="indeterminate"></md-progress-circular>
					</div>
				</md-card-content>
				<md-card-content ng-if="vm.farmMap.loaded" layout="column" layout-align="center center">
					<div layout="row" layout-align="center center" style="width: 100%">
						<span flex="auto"></span>
						<md-switch ng-model="vm.farmMap.viewSwitch" flex="20"
								ng-true-value="'Node'" ng-false-value="'Mod'">
							{{ vm.farmMap.viewSwitch }}
						</md-switch>
						<md-switch ng-model="vm.farmMap.tempSwitch" flex="20"
								ng-true-value="'Intake'" ng-false-value="'Board'"
								ng-change="vm.switchMap(0)">
							{{ vm.farmMap.tempSwitch }}
						</md-switch>
						<md-switch ng-model="vm.farmMap.mathSwitch" flex="20"
								ng-true-value="'Max'" ng-false-value="'Avg'"
								ng-change="vm.switchMap(1)">
							{{ vm.farmMap.mathSwitch }}
						</md-switch>
					</div>
					<p ng-bind-html="vm.farmMap.info" style="text-align: left; width: 100%"></p>
					<div layout="column" layout-align="start start">
						<div class="ams-maprow" ng-repeat="row in vm.rearrangedMap track by $index" layout="row">
							<div class="ams-mapcell" ng-repeat="cell in row track by $index"
									ng-if="vm.farmMap.viewSwitch === 'Node'"
									ng-style="cell.style[vm.farmMap.switch]"
									layout="column" layout-align="center center"
									ng-click="vm.gotoDetail(cell.node.ip, cell.node.port)"
									ng-mouseenter="vm.farmMap.info = vm.$sce.trustAsHtml(
										cell.node.ip + ':' + cell.node.port)"
									ng-mouseleave="vm.farmMap.info = vm.$sce.trustAsHtml('&nbsp;')">
								<p ng-if="cell.node.dead">N/A</p>
								<p ng-if="!cell.node.dead">{{ cell.node.mod_num }} Mods</p>
								<p ng-if="!cell.node.dead">{{ vm.numberShorten(cell.node.mhs) }}</p>
								<p ng-if="!cell.node.dead && vm.farmMap.mathSwitch === 'Max'">
									{{ cell.node.max_tempI | number: 1 }}
									/ {{ cell.node.max_tempB | number: 1 }}
								</p>
								<p ng-if="!cell.node.dead && vm.farmMap.mathSwitch === 'Avg'">
									{{ cell.node.avg_tempI | number: 1 }}
									/ {{ cell.node.avg_tempB | number: 1 }}
								</p>
							</div>
							<div class="ams-mapcell" ng-repeat="cell in row track by $index"
									ng-if="vm.farmMap.viewSwitch === 'Mod'"
									style="background-color: #eeeeee"
									layout="column" layout-align="start start">
								<div ng-repeat="mrow in cell.modules track by $index"
										ng-if="!cell.node.dead && mrow" layout="row">
									<div ng-repeat="mcell in mrow track by $index"
											style="
												width: {{ vm.farmMap.modWidth }}px;
												height: {{ vm.farmMap.modHeight }}px;
												background-color:
													{{mcell.style[vm.farmMap.switch]['background-color']}}"
											ng-click="vm.gotoDetail(cell.node.ip, cell.node.port, mcell.dna)"
											ng-mouseenter="vm.farmMap.info = vm.$sce.trustAsHtml(
												cell.node.ip + ':' + cell.node.port + ' ' + mcell.id +
												'&nbsp;&nbsp;&nbsp;&nbsp;' + mcell.ghsmm + ' GHs' +
												'&nbsp;&nbsp;&nbsp;&nbsp;' + mcell.temp + '&deg;C' +
												'&nbsp;&nbsp;&nbsp;&nbsp;' + mcell.temp0 + '&deg;C' +
												' / ' + mcell.temp1 + '&deg;C')"
											ng-mouseleave="vm.farmMap.info = vm.$sce.trustAsHtml('&nbsp;')">
									</div>
								</div>
							</div>
						</div>
					</div>
				</md-card-content>
			</md-card>
			<!--END Map-->
		</md-content>

		<md-content flex>
			<!--END Issue-->
			<md-card>
				<md-card-header>
					<md-card-header-text>
						<div class="md-title">Issues</div>
					</md-card-header-text>
				</md-card-header>
				<md-card-content ng-if="!vm.issueLoaded" layout="row" layout-align="center center">
					<div layout="column" layout-align="center center">
						<md-progress-circular class="md-accent" md-mode="indeterminate"></md-progress-circular>
					</div>
				</md-card-content>
				<md-card-content ng-if="vm.issueLoaded">
					<md-table-container>
						<table md-table md-progress="deferred">
							<thead md-head>
								<tr md-row>
									<th md-column>ID</th>
									<th md-column>Issue</th>
								</tr>
							</thead>
							<tbody md-body>
								<tr md-row
										ng-repeat="node in vm.data.issue.node"
										ng-click="vm.gotoDetail(node.ip, node.port)">
									<td md-cell>{{ node.ip }}:{{ node.port }}</td>
									<td md-cell>Connection failed</td>
								</tr>
								<tr md-row
										ng-repeat="module in vm.data.issue.ec"
										ng-click="vm.gotoDetail(module.ip, module.port, module.dna)">
									<td md-cell>{{ module.ip }}:{{ module.port }} {{ module.device_id }}:{{ module.module_id }} {{ module.dna }}</td>
									<td md-cell>{{ vm.ecDecode(module.ec) }}</td>
								</tr>
								<tr md-row
										ng-repeat="module in vm.data.issue.hot"
										ng-click="vm.gotoDetail(module.ip, module.port, module.dna)">
									<td md-cell>{{ module.ip }}:{{ module.port }} {{ module.device_id }}:{{ module.module_id }} {{ module.dna }}</td>
									<td md-cell>Hot Before</td>
								</tr>
							</tbody>
						</table>
					</md-table-container>
				</md-card-content>
			</md-card>
			<!--END Issue-->
		</md-content>
	</md-content>
</md-content>
